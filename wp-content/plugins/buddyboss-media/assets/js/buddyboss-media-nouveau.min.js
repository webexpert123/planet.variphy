/*! 
 * BuddyBoss Media JavaScript Library 
 * @package BuddyBoss Media 
 */function photoSwipeAjaxSuccessHandler(a,b,c){var d=bbmedia_getQueryVariable(c.data,"action"),e=function(a){return function(){var b=["activity_get_older_updates","post_update","new_activity_comment","delete_activity_comment","activity_widget_filter","get_single_activity_content"];-1!==b.indexOf(a)&&(initPhotoSwipeFromDOM(".bbmedia-grid-wrapper"),initPhotoSwipeFromDOM("#bbmedia-grid-wrapper"))}}(d);window.setTimeout(e,205),window.setTimeout(e,750)}function bbmedia_getQueryVariable(a,b){if("string"!=typeof a||""==a||"undefined"==typeof b||""==b)return"";for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==b)return e[1]}return!1}function setMediaPageVisibilityChange(){document[hidden]||setMediaPageCookie()}function setMediaPageCookie(){jq("body").hasClass("buddyboss-media-all-media")?docCookies.setItem("bp-bboss-is-media-page","yes","","/"):docCookies.removeItem("bp-bboss-is-media-page","/")}function tall_images_height_scale(a,b){var c=jq(a).find("img").height(),d=jq(b).find("img").height();c<d?(jq(a).height(d),jq(a).find("img").height(d),jq(b).height(d),jq(b).find("img").height(d)):d<c&&(jq(b).height(c),jq(b).find("img").height(c),jq(a).height(c),jq(a).find("img").height(c))}function bbm_ps_mark_favorite(a){jq(a).find(".buddyboss-media-photo-wrap .buddyboss-media-photo").each(function(){var a=jq(this).attr("data-favorite-count");jq(this).attr("data-bbmfav","bbm-unfav"),jq(this).attr("data-favorite-count",parseInt(a)+1)})}function bbm_ps_mark_unfavorite(a){jq(a).find(".buddyboss-media-photo-wrap .buddyboss-media-photo").each(function(){var a=jq(this).attr("data-favorite-count");jq(this).attr("data-bbmfav","bbm-fav"),0==a?jq(this).attr("data-favorite-count",parseInt(a)):jq(this).attr("data-favorite-count",parseInt(a)-1)})}function buddyboss_media_initiate_media_move(a){if($link=jq(a),$form=jq("#frm_buddyboss-media-move-media"),$form_wrapper=$form.parent(),$link.closest(".activity").find("form.ac-form").slideUp(),$form_wrapper.is(":visible"))return buddyboss_media_move_media_close(),!1;jq(".buddyboss-activity-comments-form").hide(),$link.closest(".activity-content").after($form_wrapper);var b=$link.data("album_id");return b||(b=""),$form.find("#buddyboss_media_move_media_albums").val(b),$form_wrapper.slideDown(200),bbmedia_move_media_opened=!0,$form.find('input[name="activity_id"]').val($link.data("activity_id")),!1}function buddyboss_media_submit_media_move(){if($form=jq("#frm_buddyboss-media-move-media"),$submit_button=$form.find('input[type="submit"]'),$submit_button.hasClass("loading"))return!1;var a=$form.find('select[name="buddyboss_media_move_media_albums"]').val(),b={action:$form.find('input[name="action"]').val(),bboss_media_move_media_nonce:$form.find('input[name="bboss_media_move_media_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),buddyboss_media_move_media_albums:a};return $submit_button.addClass("loading"),$form.find("#message").removeAttr("class").html(""),jq.ajax({type:"POST",url:ajaxurl,data:b,success:function(b){b=jq.parseJSON(b),b.status?($form.find("#message").addClass("updated published").html("<p>"+b.message+"</p>"),"yes"==$form.find('input[name="is_single_album"]').val()?setTimeout(function(){buddyboss_media_media_move_cleanup($form,!0)},2e3):setTimeout(function(){buddyboss_media_media_move_cleanup($form,!1)},2e3),$form.parents("li.activity-item").find("a.buddyboss_media_move").data("album_id",a)):$form.find("#message").addClass("error").html("<p>"+b.message+"</p>"),$submit_button.removeClass("loading")}}),!1}function buddyboss_media_media_move_cleanup(a,b){a.find("#message").removeAttr("class").html(""),$form_wrapper=a.parent(),buddyboss_media_move_media_close(),b&&($activity=a.closest(".activity"),jq("body").append($form_wrapper),$form_wrapper.hide(),$activity.slideUp(200,function(){$activity.remove()}))}function buddyboss_media_move_media_close(){return $form=jq("#frm_buddyboss-media-move-media"),$form_wrapper=$form.parent(),$form_wrapper.slideUp(200),bbmedia_move_media_opened=!1,!1}function buddyboss_media_initiate_tagging(a){return $link=jq(a),$form=jq("#frm_buddyboss-media-tag-friends"),$form_wrapper=$form.parent(),$link.closest(".activity").find("form.ac-form").slideUp(),$form_wrapper.is(":visible")?(buddyboss_media_tag_friends_close(),!1):(jq(".buddyboss-activity-comments-form").hide(),$link.closest(".activity-content").after($form_wrapper),$form_wrapper.slideDown(200),bbmedia_tag_friends_opened=!0,$form.find('input[name="ac_search"]').off("input").on("input",function(){buddyboss_media_tag_friends_search()}),$form.find(".preloading").show(),$form.find('input[name="activity_id"]').val($link.data("activity_id")),buddyboss_media_tag_friends_search(),!1)}function buddyboss_media_tag_friends_close(){return $form=jq("#frm_buddyboss-media-tag-friends"),$form_wrapper=$form.parent(),$form.data("doingsearch","no"),$form.find("#invite-list > ul").html(""),$form.find('input[name="ac_search"]').off("input").val("").hide(),$form_wrapper.slideUp(200),bbmedia_tag_friends_opened=!1,!1}function buddyboss_media_tag_friends_search(){if($form=jq("#frm_buddyboss-media-tag-friends"),"yes"==$form.data("doingsearch"))return!1;var a=jq.trim($form.find('input[name="ac_search"]').val()),b=[];$form.find("#invite-list > ul > li").each(function(){jq(this).hasClass("more_i10")?jq(this).remove():jq(this).find('input[type="checkbox"]').is(":checked")?b.push(jq(this).find('input[type="checkbox"]').val()):jq(this).remove()}),$form.data("doingsearch","yes"),$form.find(".preloading").show(),$form.find("#message").each(function(){jq(this).remove()});var c={action:$form.find('input[name="action"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),search_term:a,exclude_ids:b};return jq.ajax({type:"POST",url:ajaxurl,data:c,success:function(b){if("no"!=$form.data("doingsearch")){if($form.find(".preloading").hide(),b=jq.parseJSON(b),$ul=$form.find("#invite-list > ul"),b.friends_list){for(var d=b.friends_list.length,e=0;e<d;e++)$ul.append(b.friends_list[e]);if(d<b.total){var f=b.total-d,g=b.more_i10.replace("xx",f);$ul.append("<li class='more_i10'>"+g+"</li>")}$ul.show()}else""!=$ul.html()&&$form.find("#invite-list").append(b.error);jq('#invite-list input[name="friends[]"]').unbind("change").bind("change",function(){buddyboss_media_tag_friends_toggle_tag(c.activity_id,jq(this).val())}),jq("#friend-list .action .remove").click(function(a){a.preventDefault(),buddyboss_media_tag_friends_toggle_tag(c.activity_id,jq(this).data("userid"))}),""==a&&b.show_search&&$form.find('input[name="ac_search"]').show(),$form.data("doingsearch","no")}}}),!1}function buddyboss_media_tag_friends_toggle_tag(a,b){$form=jq("#frm_buddyboss-media-tag-friends");var c={action:$form.find('input[name="action_tag"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:a,friend_id:b};jq.ajax({type:"POST",url:ajaxurl,data:c,success:function(a){}})}function buddyboss_media_tag_friends_complete(){$form=jq("#frm_buddyboss-media-tag-friends");var a={action:$form.find('input[name="action_tag_complete"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),update_action:!1};return $form.closest(".activity").find(BuddyBoss_Media_Appstate.activity_header_selector).length>0&&(a.update_action=!0),$form.find('input[type="submit"]').addClass("loading"),jq.ajax({type:"POST",url:ajaxurl,data:a,success:function(b){$form.find('input[type="submit"]').removeClass("loading"),a.update_action===!0&&(b=jq.parseJSON(b),$activity=$form.closest(".activity"),$activity.find(BuddyBoss_Media_Appstate.activity_header_selector).html(b.activity_action),b.activity_tooltip&&($activity.find(".buddyboss-media-tt-content").remove(),$activity.append(b.activity_tooltip),window.BBMediaTooltips.initTooltips())),buddyboss_media_tag_friends_close()}}),!1}var jq=$=jQuery.noConflict();window.Code=window.Code||{Util:!1,PhotoSwipe:!1},window.BuddyBoss_Media_Util=function(a,b,c,d){function e(){!h.state.isMobile&&g.width()<=800?h.state.isMobile=!0:h.state.isMobile||(h.state.isMobile=!1)}var f,g=b(a),h={state:c,lang:function(a){var a=a||"undefined key!";return c[a]||"Language key missing for: "+a}};return e(),g.on("resize orientationchange",function(){clearTimeout(f),f=setTimeout(e,75)}),h}(window,window.jQuery,window.BuddyBoss_Media_Appstate||{});var initPhotoSwipeFromDOM=function(a){for(var b=function(a){for(var b,c,d,e=jQuery(a).find(".photo-item"),f=e.length,g=[],h=0;h<f;h++)b=e[h],1===b.nodeType&&(c=jQuery(b).find(".buddyboss-media-photo-wrap"),d={src:jQuery(c).attr("href"),attachment_id:jQuery(c).data("id"),act_id:jQuery(c).data("activity-id"),w:parseInt(jQuery(c).data("width"),10),h:parseInt(jQuery(c).data("height"),10),fav_count:jQuery(c).find(".buddyboss-media-photo").data("favorite-count"),comment_count:jQuery(c).find(".buddyboss-media-photo").data("comment-count"),is_fav:jQuery(c).find(".buddyboss-media-photo").data("bbmfav"),permalink:jQuery(c).find(".buddyboss-media-photo").data("permalink"),is_owner:jQuery(c).find(".buddyboss-media-photo").data("owner"),title:jQuery(c).data("caption"),caption_el:jQuery(c).closest(".photo-item").find(".buddyboss_media_caption")},d.el=b,g.push(d));return g},c=function(b){b=b||window.event,b.preventDefault?b.preventDefault():b.returnValue=!1;var c=b.target||b.srcElement;if(jQuery(c).closest(".buddyboss-media-photo-wrap").length){for(var e,f=jQuery(c).closest(".buddyboss-media-photo-wrap"),g=f.closest(a),h=f.closest(a).find(".buddyboss-media-photo-wrap"),i=h.length,j=0,k=0;k<i;k++)if(1===h[k].nodeType){if(jQuery(h[k]).data("id")==f.data("id")){e=j;break}j++}return e>=0&&d(e,g),!1}},d=function(a,c,d,e){var f,g,h,i=document.querySelectorAll(".pswp")[0];if(h=b(c),g={galleryUID:jQuery(c).data("pswp-uid"),shareButtons:[{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],addCaptionHTMLFn:function(a,b,c){return a.caption_el?($caption=a.caption_el,$comment=$caption.find(".buddyboss_media_caption_body"),$comment.find("a").remove(),current_photo_activity_text=$comment.text(),""===current_photo_activity_text.replace(/\s/g,"")&&(current_photo_activity_text=$caption.find(".buddyboss_media_caption_action").text()),b.children[0].innerHTML='<a href="'+a.permalink+'">'+current_photo_activity_text+"</a>",!0):(b.children[0].innerHTML="",!1)}},e)if(g.galleryPIDs){for(var j=0;j<h.length;j++)if(h[j].pid==a){g.index=j;break}}else g.index=parseInt(a,10)-1;else g.index=parseInt(a,10);isNaN(g.index)||(d&&(g.showAnimationDuration=0),f=new PhotoSwipe(i,PhotoSwipeUI_Default,h,g),f.init(),f.listen("imageLoadComplete",function(a,b){"undefined"!=typeof b.fav_count&&jq(i).find(".ps-favorite-count").text(b.fav_count),"undefined"!=typeof b.comment_count&&jq(i).find(".ps-comment-count").text(b.comment_count),"undefined"!=typeof b.permalink&&jq(i).find(".pswp__button--comment").data("permalink",b.permalink),"undefined"!=typeof b.is_fav&&(jq(i).find(".pswp__button--favorite").addClass(b.is_fav),"unfav"==b.is_fav?jq(i).find(".pswp__button--favorite").attr("title",BP_DTheme.mark_as_fav):jq(i).find(".pswp__button--favorite").attr("title",BP_DTheme.remove_fav)),"undefined"!=typeof b.is_owner&&"0"==b.is_owner?jq(i).find(".pswp__button--delete").hide():"undefined"!=typeof b.is_owner&&"1"==b.is_owner&&jq(i).find(".pswp__button--delete").show()}),f.listen("destroy",function(){jq(i).find(".ps-favorite-count").text(""),jq(i).find(".ps-comment-count").text(""),jq(i).find(".pswp__button--comment").data("permalink",""),jq(i).find(".pswp__button--favorite").removeClass("bbm-fav").removeClass("bbm-unfav"),jq(i).find(".pswp__button--delete").show()}),jq(i).on("click",".pswp__button--comment",function(a){a.preventDefault(),"undefined"!=typeof f.currItem.permalink&&""!=f.currItem.permalink&&(window.location.href=f.currItem.permalink)}),jq(i).on("click",".pswp__button--delete",function(a){if(a.preventDefault(),"undefined"==typeof f.currItem.is_owner)return!1;if("1"==f.currItem.is_owner){if(jq(i).find(".pswp__button--delete").hasClass("deleting"))return!1;confirm(BuddyBoss_Media_Appstate.sure_delete_photo)&&(jq(i).find(".pswp__button--delete").addClass("deleting"),jq.ajax({type:"POST",url:ajaxurl,data:{action:"buddyboss_delete_media",media:f.currItem.act_id,"photo-id":f.currItem.attachment_id},success:function(a){return window.location.reload(),!1},error:function(a){jq(i).find(".pswp__button--delete").removeClass("deleting")}}))}}),jq(i).on("click",".pswp__button--favorite",function(a){if(a.preventDefault(),jq(i).find(".pswp__button--favorite").hasClass("marking"))return!1;jq(i).find(".pswp__button--favorite").addClass("marking");var b="fav";"undefined"!=typeof f.currItem.is_fav&&"bbm-unfav"==f.currItem.is_fav&&(b="unfav"),jq.ajax({type:"POST",url:ajaxurl,data:{action:"bbm_activity_mark_"+b,id:f.currItem.act_id,item_type:"bbm_activity_mark"},dataType:"json",success:function(a){jq(i).find(".pswp__button--favorite").removeClass("bbm-fav").removeClass("bbm-unfav"),"unfav"==b?(jq(i).find(".pswp__button--favorite").addClass("bbm-unfav"),jq(i).find(".pswp__button--favorite").attr("title",BP_DTheme.mark_as_fav),f.currItem.is_fav="bbm-fav"):(jq(i).find(".pswp__button--favorite").addClass("bbm-fav"),jq(i).find(".pswp__button--favorite").attr("title",BP_DTheme.remove_fav),f.currItem.is_fav="bbm-unfav"),"undefined"!=typeof a.count&&jq(i).find(".ps-favorite-count").text(a.count),jq(i).find(".pswp__button--favorite").removeClass("marking")},error:function(a){jq(i).find(".pswp__button--favorite").removeClass("marking")}})}))},e=document.querySelectorAll(a),f=0,g=e.length;f<g;f++)e[f].setAttribute("data-pswp-uid",f+1),e[f].onclick=c;e.length&&jq(document).ajaxSuccess(photoSwipeAjaxSuccessHandler)};"undefined"!=typeof PhotoSwipe&&(initPhotoSwipeFromDOM(".bbmedia-grid-wrapper"),initPhotoSwipeFromDOM("#bbmedia-grid-wrapper")),window.BuddyBoss_Media_Uploader=function(a,b,c,d){var e=!1,f={},g=0,h=c.state||{},i=c.lang,j=[],k={init:function(){var a=this;return this.inject_markup(),!!this.get_elements()&&(this.setup_modal(),this.setup_textbox(),setTimeout(function(){a.start_uploader()},10),b.ajaxPrefilter(k.prefilter),void b(document).ajaxSuccess(k.ajaxSuccessHandler))},destroy:function(){},ajaxSuccessHandler:function(a,c,d){var e=bbmedia_getQueryVariable(d.data,"action");if("post_update"==e){var f=BBOSS_MEDIA.photo_component_slug,g={action:"bbm_photo_counts"};b.ajax({type:"GET",url:ajaxurl,data:g,success:function(a){if(a.success){var c=b("#"+f+"-personal-li #user-"+f+" span");c.length>0&&c.text(a.data)}}})}},inject_markup:function(){var a=b(".my-gallery .activity-greeting"),c=i("user_add_photo");a.length&&c&&a.text(c).show();var d=b("#whats-new-content"),e=b("#buddyboss-media-tpl-add-photo");e.length&&d.length&&d.before(e.html());var f=b("#buddyboss-media-tpl-preview");f.length&&d.length&&"undefined"==typeof bbpress_media&&d.find("textarea").after(f.html())},get_elements:function(){return f.$whats_new=b("#whats-new"),(0!==f.$whats_new.length||"undefined"!=typeof bbpress_media)&&(f.$add_photo=b("#buddyboss-media-bulk-uploader"),f.$whats_new_form=b("#whats-new-form"),f.$open_uploder_button=b("#buddyboss-media-open-uploader-button"),f.$add_photo_button=b("#logo-file-browser-button"),f.$post_button=b("#whats-new-submit").find("[type=submit],button"),f.$uploader=b("#buddyboss-media-bulk-uploader"),f.$uploaded=b("#buddyboss-media-bulk-uploader-uploaded .images"),f.$preview_pane=b("#buddyboss-media-preview-inner"),f.$privacy_bp=b("#bbwall-activity-privacy"),f.$privacy_modal=b("#bbm-media-privacy"),!0)},setup_textbox:function(){f.$whats_new.blur(function(){setTimeout(function(){j&&j.length>0&&(f.$post_button.removeAttr("disabled"),f.$post_button.prop("disabled",!1))},200)})},setup_modal:function(){b("#buddyboss-media-add-photo [data-fancybox]").fancybox({minWidth:500,beforeLoad:function(){b("#buddyboss-media-bulk-uploader-text").val(f.$whats_new.val()),f.$privacy_bp.length>0&&f.$privacy_modal.val(f.$privacy_bp.val()),f.$preview_pane.hide()},beforeClose:function(){b("#buddyboss-media-bulk-uploader-text").length>0&&f.$whats_new.val(b("#buddyboss-media-bulk-uploader-text").val()),f.$privacy_bp.length>0&&f.$privacy_bp.val(f.$privacy_modal.val())},afterClose:function(){f.$preview_pane.html(f.$uploaded.html()),f.$preview_pane.show()}}),b("#aw-whats-new-submit-bbmedia").click(function(){b.fancybox.close(),f.$whats_new_form.submit()})},prefilter:function(a,c,d){var e=bbmedia_getQueryVariable(a.data,"action");if("undefined"!=typeof e&&"post_update"==e){var f,g="";if(j.length>0){for(var h=0;h<j.length;h++){var i=b("<a/>").attr("href",j[h].url).attr("target","_blank").attr("title",j[h].name).addClass("buddyboss-media-photo-link").html(j[h].name)[0].outerHTML;g+=i}f=b.extend({},c.data,{content:c.data.content+" "+g,pics_uploaded:j}),a.data=b.param(f),a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.post_success(c,d,e)}}(a.success)}else c.data&&"get_single_activity_content"===c.data.action&&(a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.readmore_success(c,d,e)}}(a.success))}},post_success:function(a){var c=b("li.new-update").find(".buddyboss-media-photo-wrap");c.length>0&&"object"==typeof BuddyBossSwiper&&BuddyBossSwiper.hasOwnProperty("reset")&&BuddyBossSwiper.reset(),j=[],f.$preview_pane.html(""),f.$uploaded.html(""),e.splice(0,e.files.length),g=0},start_uploader:function(){var a,c=0,d=navigator.userAgent.indexOf("IEMobile")!==-1;if(d&&f.$add_photo.addClass("legacy"),e=new plupload.Uploader({runtimes:h.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:f.$add_photo_button[0],container:"buddyboss-media-bulk-uploader-reception",drop_element:"buddyboss-media-bulk-uploader-wrapper",multi_selection:h.uploader_multiselect||!1,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:BBOSS_MEDIA.media_upload_nonce},flash_swf_url:h.uploader_swf_url||"",silverlight_xap_url:h.uploader_xap_url||"",filters:{max_file_size:h.uploader_filesize||"10mb",mime_types:h.uploader_filetypes||"jpg,jpeg,gif,png,bmp",title:i("file_browse_title"),prevent_duplicates:!0},init:{Init:function(){"0"==f.$add_photo.find(".moxie-shim").find("input").length?(f.$add_photo.find(".moxie-shim").first().css("z-index",10),f.$add_photo.find(".moxie-shim").css("cursor","pointer")):(clone=b(f.$add_photo_button[0]).clone(),b(f.$add_photo_button[0]).after(clone).remove(),f.$add_photo_button[0]=clone,b(f.$add_photo_button[0]).on("click",function(){f.$add_photo.find(".moxie-shim").find("input").click()}))},FilesAdded:function(a,c){if(b("#aw-whats-new-submit-bbmedia").prop("disabled",!0),a.files.length>h.uploader_max_files||c.length>h.uploader_max_files)return e.splice(g,e.files.length),alert(i("exceed_max_files_per_batch")),!1;for(var d=0;d<c.length;d++)if(0===b('div[data-fileid="'+c[d].id+'"]').length){var j="<div data-fileid='"+c[d].id+"' class='file uploading'><img src='"+h.uploader_temp_img+"'><progress class='buddyboss-media-progress-bar' value='0' max='100'></progress></div>";f.$uploaded.append(j),f.$preview_pane.append(j),g++}a.start()},UploadProgress:function(d,e){e&&e.hasOwnProperty("percent")&&(a=b('div[data-fileid="'+e.id+'"]').find("progress"),c=e.percent,a.val(c))},FileUploaded:function(a,c,d){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1);var e=b.parseJSON(d.response);$file=b('div[data-fileid="'+c.id+'"]'),$file.removeClass("uploading"),"undefined"!=typeof bbpress_media&&$file.append("<input type='hidden' value='"+e.attachment_id+"' name='bbm_bbpress_attachments[]'>"),$file.data("attachment_id",e.attachment_id),$file.find(">img").attr("src",e.url),$file.find("progress").replaceWith("<a href='#' onclick='return window.BuddyBoss_Media_Uploader.removeUploaded(\""+c.id+"\");' class='delete'>+</a>"),j.push(e)},Error:function(a,c){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1),alert(i("error_uploading_photo")),$progressWrap.removeClass("uploading"),$postButton.prop("disabled",!1).removeClass("loading")}}}),e.init(),b(".fancybox-close").on("click",function(){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1)}),b("#buddyboss-media-bulk-uploader-reception-fake").length>0){var k=document.getElementById("buddyboss-media-bulk-uploader-reception-fake");$additional_dropzone=b(k);var l=new moxie.file.FileDrop({drop_zone:k});l.ondrop=function(a){f.$open_uploder_button.click(),e.addFile(l.files)},l.init();var m=new moxie.file.FileInput({browse_button:b("a.browse-file-button",$additional_dropzone)[0],container:k,multiple:!0});m.onchange=function(a){f.$open_uploder_button.click(),e.addFile(m.files)},m.init()}if(b("#buddyboss-media-add-photo").length>0&&"false"===BBOSS_MEDIA.is_media_page&&"false"===BBOSS_MEDIA.is_photo_page){var k=document.getElementById("buddyboss-media-add-photo");$additional_dropzone=b(k);var m=new moxie.file.FileInput({browse_button:b(".browse-file-button")[0],container:k,multiple:!0});m.onchange=function(a){e.addFile(m.files)},m.init()}},removeUploaded:function(a){var c=b('div[data-fileid="'+a+'"]');if(j.length>0){for(var d=[],f=0;f<j.length;f++)j[f].attachment_id!==c.data("attachment_id")&&d.push(j[f]);j=d}var h=!1;return b.each(e.files,function(b,c){c.hasOwnProperty("id")&&c.id==a&&(h=c)}),h&&(e.removeFile(h),g--),c.remove(),!1}},l={setup:function(){k.init()},teardown:function(){k.destroy()},removeUploaded:function(a){return k.removeUploaded(a)}};return b(document).ready(function(){k.init()}),l}(window,window.jQuery,window.BuddyBoss_Media_Util),window.BuddyBoss_Edit_Media_Uploader=function(a,b,c,d){var e=!1,f={},g=0,h=c.state||{},i=c.lang,j=[],k={init:function(){var a=this;return!!this.get_elements()&&(setTimeout(function(){a.start_uploader()},10),b.ajaxPrefilter(k.prefilter),b(document).ajaxSuccess(k.ajaxSuccessHandler),void b(document).on("click","a.buddyboss_edit_activity.action-edit, a.buddyboss_edit_activity_comment",k.editActivityMediaPreview))},destroy:function(){},prefilter:function(a,c,d){var e=bbmedia_getQueryVariable(a.data,"action");if("undefined"!=typeof e&&"buddypress-edit-activity-save"==e){var f=[];b("#buddyboss-edit-media-preview .file").map(function(a,c){f[a]=b(c).data("media-id")});var g=b.extend({},c.data,{buddyboss_media_aid:f});a.data=b.param(g)}},get_elements:function(){return f.$add_photo=b("#buddyboss-edit-media-bulk-uploader"),f.$open_uploder_button=b("#buddyboss-edit-media-open-uploader-button"),f.$add_photo_button=b("#browse-file-button"),f.$uploaded=b("#buddyboss-media-bulk-uploader-uploaded .images"),f.$preview_pane=b("#buddyboss-edit-media-preview-inner"),!0},editActivityMediaPreview:function(c){if(a.keep_activity_changes)return!1;$elm_edit_btn=b(this);var d=($elm_edit_btn.data("activity_id"),{action:"buddypress_edit_activity_media_content",activity_id:$elm_edit_btn.data("activity_id")});b.ajax({type:"POST",url:ajaxurl,data:d,success:function(a){$media_edit_wrapper=b("#buddyboss-edit-media-preview-inner"),$media_edit_wrapper.html(a)}})},start_uploader:function(){var a,c=0,d=navigator.userAgent.indexOf("IEMobile")!==-1;if(d&&f.$add_photo.addClass("legacy"),e=new plupload.Uploader({runtimes:h.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:f.$add_photo_button[0],container:"buddyboss-edit-media-bulk-uploader-reception",drop_element:"buddyboss-edit-media-bulk-uploader-wrapper",multi_selection:h.uploader_multiselect||!1,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:BBOSS_MEDIA.media_upload_nonce},flash_swf_url:h.uploader_swf_url||"",silverlight_xap_url:h.uploader_xap_url||"",filters:{max_file_size:h.uploader_filesize||"10mb",mime_types:h.uploader_filetypes||"jpg,jpeg,gif,png,bmp",title:i("file_browse_title"),prevent_duplicates:!0},init:{Init:function(){"0"==f.$add_photo.find(".moxie-shim").find("input").length?(f.$add_photo.find(".moxie-shim").first().css("z-index",10),f.$add_photo.find(".moxie-shim").css("cursor","pointer")):(clone=b(f.$add_photo_button[0]).clone(),b(f.$add_photo_button[0]).after(clone).remove(),f.$add_photo_button[0]=clone,b(f.$add_photo_button[0]).on("click",function(){f.$add_photo.find(".moxie-shim").find("input").click()}))},FilesAdded:function(a,c){if(b("#aw-whats-new-submit-bbmedia").prop("disabled",!0),a.files.length>h.uploader_max_files||c.length>h.uploader_max_files)return e.splice(g,e.files.length),alert(i("exceed_max_files_per_batch")),!1;for(var d=0;d<c.length;d++)if(0===b('div[data-fileid="'+c[d].id+'"]').length){var j="<div data-fileid='"+c[d].id+"' class='file uploading'><img src='"+h.uploader_temp_img+"'><progress class='buddyboss-media-progress-bar' value='0' max='100'></progress></div>";f.$uploaded.append(j),f.$preview_pane.append(j),g++}a.start()},UploadProgress:function(d,e){e&&e.hasOwnProperty("percent")&&(a=b('div[data-fileid="'+e.id+'"]').find("progress"),c=e.percent,a.val(c))},FileUploaded:function(a,c,d){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1);var e=b.parseJSON(d.response);$file=b('div[data-fileid="'+c.id+'"]'),$file.removeClass("uploading"),$file.data("media-id",e.attachment_id),$file.find(">img").attr("src",e.url),$file.find("progress").replaceWith("<a href='#' onclick='return window.BuddyBoss_Media_Uploader.removeUploaded(\""+c.id+"\");' class='delete'>+</a>"),j.push(e)},Error:function(a,c){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1),alert(i("error_uploading_photo")),$progressWrap.removeClass("uploading"),$postButton.prop("disabled",!1).removeClass("loading")}}}),e.init(),b(".fancybox-close").on("click",function(){b("#aw-whats-new-submit-bbmedia").prop("disabled",!1)}),b("#buddyboss-media-bulk-uploader-reception-fake").length>0){var k=document.getElementById("buddyboss-media-bulk-uploader-reception-fake");$additional_dropzone=b(k);var l=new moxie.file.FileDrop({drop_zone:k});if(l.ondrop=function(a){f.$open_uploder_button.click(),e.addFile(l.files)},l.init(),b("#buddyboss-edit-media-add-photo .browse-file-button").is(":visible")){var m=new moxie.file.FileInput({browse_button:b("#buddyboss-edit-media-add-photo .browse-file-button",$additional_dropzone)[0],container:k,multiple:!0});m.onchange=function(a){f.$open_uploder_button.click(),e.addFile(m.files)},m.init()}}if(b("#buddyboss-edit-media-add-photo a.buddyboss-media-add-photo").length>0&&"false"===BBOSS_MEDIA.is_photo_page){var k=document.getElementById("buddyboss-media-add-photo");$additional_dropzone=b(k);var m=new moxie.file.FileInput({browse_button:b("#buddyboss-edit-media-add-photo .browse-file-button")[0],container:k,multiple:!0});m.onchange=function(a){e.addFile(m.files)},m.init()}},removeUploaded:function(a){var c=b('div[data-fileid="'+a+'"]');if(j.length>0){for(var d=[],f=0;f<j.length;f++)j[f].attachment_id!==c.data("attachment_id")&&d.push(j[f]);j=d}var h=!1;return b.each(e.files,function(b,c){c.hasOwnProperty("id")&&c.id==a&&(h=c)}),h&&(e.removeFile(h),g--),c.remove(),!1},editActivityRemoveMedia:function(a){var c=b(a);c.parent().remove()}},l={setup:function(){k.init()},teardown:function(){k.destroy()},removeUploaded:function(a){return k.removeUploaded(a)},editActivityRemoveMedia:function(a){return k.editActivityRemoveMedia(a)}};return b(document).ready(function(){k.init()}),l}(window,window.jQuery,window.BuddyBoss_Media_Util),window.BuddyBoss_Comment_Media_Uploader=function(a,b,c,d){var e=!1,f={},g=0,h=c.state||{},i=c.lang,j=[],k={init:function(){var a=this;return this.inject_markup(),!!this.get_elements()&&(b(document).on("click",".buddyboss-comment-media-add-photo-button",k.set_post_button),b("ul#activity-stream").on("click","a.acomment-reply",k.set_file_browse_button),this.setup_modal(),setTimeout(function(){a.start_uploader()},10),b.ajaxPrefilter(k.prefilter),void b(document).ajaxSuccess(k.ajaxSuccessHandler))},destroy:function(){},inject_markup:function(){var a=b("input[name='ac_form_submit']:not(.has-comment-media-button)"),c=b("#buddyboss-comment-media-tpl-add-photo");c.length&&a.length&&(a.before(c.html()),a.addClass("has-comment-media-button"));var d=b("#buddyboss-comment-media-tpl-preview");if(d.length&&a.length){var e=b(".ac-reply-content:not(.has-comment-media-button)");e.after(d.html()),e.addClass("has-comment-media-button")}},get_elements:function(){return f.$comment_input=null,f.$browse_file_button=null,f.$comment_media_container=null,f.$add_photo=b("#buddyboss-comment-media-bulk-uploader"),f.$open_uploder_button=b(".open-uploader-button.buddyboss-comment-media-add-photo-button"),f.$add_photo_button=b(".logo-comment-file-browser-button"),f.$post_button=null,f.$uploader=b("#buddyboss-comment-media-bulk-uploader"),f.$uploaded=b(".buddyboss-comment-media-bulk-uploader-uploaded .images"),f.$preview_pane=b(".buddyboss-comment-media-preview-inner"),!0},setup_modal:function(){b(".buddyboss-comment-media-add-photo [data-fancybox]").each(function(){var a=b(this);a.fancybox({minWidth:500,beforeLoad:function(){$attach_comment_media_button=a.parents(".ac-reply-content"),f.$post_button=$attach_comment_media_button.find("input[name=ac_form_submit]"),f.$comment_input=$attach_comment_media_button.find("textarea"),b(".buddyboss-comment-media-bulk-uploader-text").val(f.$comment_input.val())},beforeClose:function(){b(".buddyboss-comment-media-bulk-uploader-text").length>0&&f.$comment_input.val(b(".buddyboss-comment-media-bulk-uploader-text").val())},afterClose:function(){f.$preview_pane.html(f.$uploaded.html()),f.$preview_pane.show()}})}),b("#buddyboss-comment-media-attach").click(function(){b.fancybox.close(),f.$post_button.trigger("click")})},set_post_button:function(a){$attach_comment_media_button=b(this).parents(".ac-reply-content"),f.$post_button=$attach_comment_media_button.find("input[name=ac_form_submit]"),f.$comment_input=$attach_comment_media_button.find("textarea")},set_file_browse_button:function(a){$acomment_reply_button=b(this),$activity_comment_div=$acomment_reply_button.closest(".activity-item").find(".activity-comments"),f.$browse_file_button=$activity_comment_div.find(".browse-file-button"),f.$comment_media_container=$activity_comment_div.find(".buddyboss-comment-media-add-photo");var c=new moxie.file.FileInput({browse_button:f.$browse_file_button.get(0),container:f.$comment_media_container.get(0),multiple:!0});c.onchange=function(a){e.addFile(c.files)},c.init()},prefilter:function(a,c,d){var e=bbmedia_getQueryVariable(a.data,"action");if("undefined"!=typeof e&&"new_activity_comment"==e){var f,g="";if(j.length>0){for(var h=0;h<j.length;h++){var i=b("<a/>").attr("href",j[h].url).attr("target","_blank").attr("title",j[h].name).addClass("buddyboss-media-photo-link").html(j[h].name)[0].outerHTML;g+=i}f=b.extend({},c.data,{content:c.data.content+" "+g,pics_uploaded:j}),a.data=b.param(f),a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.post_success(c,d,e)}}(a.success)}else c.data&&"get_single_activity_content"===c.data.action&&(a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.readmore_success(c,d,e)}}(a.success))}},ajaxSuccessHandler:function(a,b,c){var d=bbmedia_getQueryVariable(c.data,"action"),e=["activity_get_older_updates","post_update","activity_widget_filter","activity_filter"];-1!=e.indexOf(d)&&setTimeout(function(){k.inject_markup()},2e3)},post_success:function(a){var c=b("li.new-update").find(".buddyboss-media-photo-wrap");c.length>0&&"object"==typeof BuddyBossSwiper&&BuddyBossSwiper.hasOwnProperty("reset")&&BuddyBossSwiper.reset(),j=[],f.$preview_pane.html(""),f.$uploaded.html(""),e.splice(0,e.files.length),g=0},start_uploader:function(){var a,c=0,d=navigator.userAgent.indexOf("IEMobile")!==-1;if(d&&f.$add_photo.addClass("legacy"),e=new plupload.Uploader({runtimes:h.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:f.$add_photo_button[0],
container:"buddyboss-comment-media-bulk-uploader-reception",drop_element:"buddyboss-comment-media-bulk-uploader-wrapper",multi_selection:h.uploader_multiselect||!1,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:BBOSS_MEDIA.media_upload_nonce},flash_swf_url:h.uploader_swf_url||"",silverlight_xap_url:h.uploader_xap_url||"",filters:{max_file_size:h.uploader_filesize||"10mb",mime_types:h.uploader_filetypes||"jpg,jpeg,gif,png,bmp",title:i("file_browse_title"),prevent_duplicates:!0},init:{Init:function(){"0"==f.$add_photo.find(".moxie-shim").find("input").length?(f.$add_photo.find(".moxie-shim").first().css("z-index",10),f.$add_photo.find(".moxie-shim").css("cursor","pointer")):(clone=b(f.$add_photo_button[0]).clone(),b(f.$add_photo_button[0]).after(clone).remove(),f.$add_photo_button[0]=clone,b(f.$add_photo_button[0]).on("click",function(){f.$add_photo.find(".moxie-shim").find("input").click()}))},FilesAdded:function(a,c){if(jQuery(".has-comment-media-button").prop("disabled",!0),jQuery("#buddyboss-comment-media-attach").prop("disabled",!0),a.files.length>h.uploader_max_files||c.length>h.uploader_max_files)return e.splice(g,e.files.length),alert(i("exceed_max_files_per_batch")),!1;for(var d=0;d<c.length;d++)if(0===b('div[data-fileid="'+c[d].id+'"]').length){var j="<div data-fileid='"+c[d].id+"' class='file uploading'><img src='"+h.uploader_temp_img+"'><progress class='buddyboss-media-progress-bar' value='0' max='100'></progress></div>";f.$uploaded.append(j),f.$preview_pane.append(j),g++}a.start()},UploadProgress:function(d,e){e&&e.hasOwnProperty("percent")&&(a=b('div[data-fileid="'+e.id+'"]').find("progress"),c=e.percent,a.val(c))},FileUploaded:function(a,c,d){jQuery(".has-comment-media-button").prop("disabled",!1),jQuery("#buddyboss-comment-media-attach").prop("disabled",!1);var e=b.parseJSON(d.response);$file=b('div[data-fileid="'+c.id+'"]'),$file.removeClass("uploading"),$file.data("attachment_id",e.attachment_id),$file.find(">img").attr("src",e.url),$file.find("progress").replaceWith("<a href='#' onclick='return window.BuddyBoss_Comment_Media_Uploader.removeUploaded(\""+c.id+"\");' class='delete'>+</a>"),j.push(e)},Error:function(a,b){jQuery(".has-comment-media-button").prop("disabled",!1),alert(i("error_uploading_photo")),$progressWrap.removeClass("uploading"),$postButton.prop("disabled",!1).removeClass("loading")}}}),e.init(),b("#buddyboss-comment-media-bulk-uploader-reception-fake").length>0){var k=document.getElementById("buddyboss-media-bulk-uploader-reception-fake");$additional_dropzone=b(k);var l=new moxie.file.FileDrop({drop_zone:k});l.ondrop=function(a){_l.$open_uploder_button.click(),e.addFile(l.files)},l.init();var m=new moxie.file.FileInput({browse_button:b("#buddyboss-comment-media-add-photo .browse-file-button",$additional_dropzone)[0],container:k,multiple:!0});m.onchange=function(a){_l.$open_uploder_button.click(),e.addFile(m.files)},m.init()}},removeUploaded:function(a){var c=b('div[data-fileid="'+a+'"]');if(j.length>0){for(var d=[],f=0;f<j.length;f++)j[f].attachment_id!==c.data("attachment_id")&&d.push(j[f]);j=d}var h=!1;return b.each(e.files,function(b,c){c.hasOwnProperty("id")&&c.id==a&&(h=c)}),h&&(e.removeFile(h),g--),c.remove(),!1}},l={setup:function(){k.init()},teardown:function(){k.destroy()},removeUploaded:function(a){return k.removeUploaded(a)}};return b(document).ready(function(){k.init()}),l}(window,window.jQuery,window.BuddyBoss_Media_Util),window.BuddyBoss_bbPress_Media_Uploader=function(a,b,c,d){var e=!1,f={},g=0,h=c.state||{},i=c.lang,j=[],k={init:function(){var a=this;return this.inject_markup(),!!this.get_elements()&&(b(document).on("click",".buddyboss-bbpress-media-add-photo-button",k.set_post_button),this.setup_modal(),setTimeout(function(){a.start_uploader()},10),b.ajaxPrefilter(k.prefilter),void b(document).ajaxSuccess(k.ajaxSuccessHandler))},destroy:function(){},inject_markup:function(){var a=b(".bbp-submit-wrapper"),c=b("#buddyboss-bbpress-media-tpl-add-photo");c.length&&a.length&&a.append(c.html())},get_elements:function(){return f.$bbpress_input=null,f.$add_photo=b("#buddyboss-bbpress-media-bulk-uploader"),f.$open_uploder_button=b(".open-uploader-button.buddyboss-bbpress-media-add-photo-button"),f.$add_photo_button=b(".logo-bbpress-file-browser-button"),f.$post_button=null,f.$uploader=b("#buddyboss-bbpress-media-bulk-uploader"),f.$uploaded=b(".buddyboss-bbpress-media-bulk-uploader-uploaded .images"),f.$preview_pane=b(".buddyboss-bbpress-media-preview-inner"),!0},setup_modal:function(){b(".buddyboss-bbpress-media-add-photo [data-fancybox]").each(function(){var a=b(this);a.fancybox({minWidth:500,beforeLoad:function(){$attach_bbpress_media_button=a.parents(".ac-reply-content"),f.$post_button=$attach_bbpress_media_button.find("input[name=ac_form_submit]"),f.$bbpress_input=$attach_bbpress_media_button.find("textarea"),b(".buddyboss-bbpress-media-bulk-uploader-text").val(f.$bbpress_input.val())},beforeClose:function(){b(".buddyboss-bbpress-media-bulk-uploader-text").length>0&&f.$bbpress_input.val(b(".buddyboss-bbpress-media-bulk-uploader-text").val())}})}),b("#buddyboss-bbpress-media-attach").click(function(){b.fancybox.close(),f.$post_button.trigger("click")})},set_post_button:function(a){$attach_bbpress_media_button=b(this).parents(".ac-reply-content"),f.$post_button=$attach_bbpress_media_button.find("input[name=ac_form_submit]"),f.$bbpress_input=$attach_bbpress_media_button.find("textarea")},prefilter:function(a,c,d){var e=bbmedia_getQueryVariable(a.data,"action");if("undefined"!=typeof e&&"new_activity_bbpress"==e){var f,g="";if(j.length>0){for(var h=0;h<j.length;h++){var i=b("<a/>").attr("href",j[h].url).attr("target","_blank").attr("title",j[h].name).addClass("buddyboss-media-photo-link").html(j[h].name)[0].outerHTML;g+=i}f=b.extend({},c.data,{content:c.data.content+" "+g,pics_uploaded:j}),a.data=b.param(f),a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.post_success(c,d,e)}}(a.success)}else c.data&&"get_single_activity_content"===c.data.action&&(a.success=function(a){return function(c,d,e){b.isFunction(a)&&a(c,d,e),c[0]+c[1]!=="-1"&&k.readmore_success(c,d,e)}}(a.success))}},ajaxSuccessHandler:function(a,b,c){var d=bbmedia_getQueryVariable(c.data,"action");"activity_get_older_updates"!=d&&"activity_filter"!=d||k.inject_markup()},post_success:function(a){var c=b("li.new-update").find(".buddyboss-media-photo-wrap");c.length>0&&"object"==typeof BuddyBossSwiper&&BuddyBossSwiper.hasOwnProperty("reset")&&BuddyBossSwiper.reset(),j=[],f.$preview_pane.html(""),f.$uploaded.html(""),e.splice(0,e.files.length),g=0},start_uploader:function(){var a,c=0,d=navigator.userAgent.indexOf("IEMobile")!==-1;if(d&&f.$add_photo.addClass("legacy"),e=new plupload.Uploader({runtimes:h.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:f.$add_photo_button[0],container:"buddyboss-bbpress-media-bulk-uploader-reception",drop_element:"buddyboss-bbpress-media-bulk-uploader-wrapper",multi_selection:h.uploader_multiselect||!1,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:BBOSS_MEDIA.media_upload_nonce},flash_swf_url:h.uploader_swf_url||"",silverlight_xap_url:h.uploader_xap_url||"",filters:{max_file_size:h.uploader_filesize||"10mb",mime_types:h.uploader_filetypes||"jpg,jpeg,gif,png,bmp",title:i("file_browse_title"),prevent_duplicates:!0},init:{Init:function(){"0"==f.$add_photo.find(".moxie-shim").find("input").length?(f.$add_photo.find(".moxie-shim").first().css("z-index",10),f.$add_photo.find(".moxie-shim").css("cursor","pointer")):(clone=b(f.$add_photo_button[0]).clone(),b(f.$add_photo_button[0]).after(clone).remove(),f.$add_photo_button[0]=clone,b(f.$add_photo_button[0]).on("click",function(){f.$add_photo.find(".moxie-shim").find("input").click()}))},FilesAdded:function(a,c){if(a.files.length>h.uploader_max_files||c.length>h.uploader_max_files)return e.splice(g,e.files.length),alert(i("exceed_max_files_per_batch")),!1;for(var d=0;d<c.length;d++)if(0===b('div[data-fileid="'+c[d].id+'"]').length){var j="<div data-fileid='"+c[d].id+"' class='file uploading'><img src='"+h.uploader_temp_img+"'><progress class='buddyboss-media-progress-bar' value='0' max='100'></progress></div>";f.$uploaded.append(j),f.$preview_pane.append(j),g++}a.start()},UploadProgress:function(d,e){e&&e.hasOwnProperty("percent")&&(a=b('div[data-fileid="'+e.id+'"]').find("progress"),c=e.percent,a.val(c))},FileUploaded:function(a,c,d){var e=b.parseJSON(d.response);$file=b('div[data-fileid="'+c.id+'"]'),$file.removeClass("uploading"),$file.data("attachment_id",e.attachment_id),$file.append("<input type='hidden' value='"+e.attachment_id+"' name='bbm_bbpress_attachments[]'>"),$file.find(">img").attr("src",e.url),$file.find("progress").replaceWith("<a href='#' onclick='return window.BuddyBoss_bbPress_Media_Uploader.removeUploaded(\""+c.id+"\");' class='delete'>+</a>"),j.push(e)},Error:function(a,b){alert(i("error_uploading_photo")),$progressWrap.removeClass("uploading"),$postButton.prop("disabled",!1).removeClass("loading")}}}),e.init(),b("#buddyboss-bbpress-media-bulk-uploader-reception-fake").length>0){var k=document.getElementById("buddyboss-media-bulk-uploader-reception-fake");$additional_dropzone=b(k);var l=new moxie.file.FileDrop({drop_zone:k});l.ondrop=function(a){_l.$open_uploder_button.click(),e.addFile(l.files)},l.init();var m=new moxie.file.FileInput({browse_button:b("a.browse-file-button",$additional_dropzone)[0],container:k,multiple:!0});m.onchange=function(a){_l.$open_uploder_button.click(),e.addFile(m.files)},m.init()}if(b(".buddyboss-bbpress-media-add-photo").length>0){var k=document.getElementsByClassName("buddyboss-bbpress-media-add-photo"),m=new moxie.file.FileInput({browse_button:b(".browse-file-button")[0],container:k[0],multiple:!0});m.onchange=function(a){e.addFile(m.files)},m.init()}},removeUploaded:function(a){var c=b('div[data-fileid="'+a+'"]');if(j.length>0){for(var d=[],f=0;f<j.length;f++)j[f].attachment_id!==c.data("attachment_id")&&d.push(j[f]);j=d}var h=!1;return b.each(e.files,function(b,c){c.hasOwnProperty("id")&&c.id==a&&(h=c)}),h&&(e.removeFile(h),g--),c.remove(),!1}},l={setup:function(){k.init()},teardown:function(){k.destroy()},removeUploaded:function(a){return k.removeUploaded(a)}};return b(document).ready(function(){k.init()}),l}(window,window.jQuery,window.BuddyBoss_Media_Util),bbmedia_move_media_opened=!1,bbmedia_tag_friends_opened=!1,jq(document).ready(function(){jq(document).keyup(function(a){27!=a.keyCode||bbmedia_move_media_opened!==!0&&bbmedia_tag_friends_opened!==!0||(bbmedia_move_media_opened===!0&&buddyboss_media_move_media_close(),bbmedia_tag_friends_opened===!0&&buddyboss_media_tag_friends_close())}),setMediaPageCookie(),jq.ajaxPrefilter(function(a,b,c){var d=a.success,e=bbmedia_getQueryVariable(a.data,"action");"undefined"!=typeof e&&"activity_get_older_updates"==e&&(a.success=function(a){jq("#bbmedia-grid-wrapper #activity-stream li.load-more").remove(),null!=d&&d(a)})}),jq("#activity-stream").on("click",".activity-meta > a.fav",function(){var a=jq(this).parents(".activity-content").find(".buddyboss-media-photos-wrap-container");a.length>0&&bbm_ps_mark_favorite(a)}),jq("#activity-stream").on("click",".activity-meta > a.unfav",function(){var a=jq(this).parents(".activity-content").find(".buddyboss-media-photos-wrap-container");a.length>0&&bbm_ps_mark_unfavorite(a)}),jq("#activity-stream").on("click",".acomment-options > a.fav-comment",function(){var a=jq(this).parent().parent().find(".acomment-content > .buddyboss-media-photos-wrap-container");a.length>0&&bbm_ps_mark_favorite(a)}),jq("#activity-stream").on("click",".acomment-options > a.unfav-comment",function(){var a=jq(this).parent().parent().find(".acomment-content > .buddyboss-media-photos-wrap-container");a.length>0&&bbm_ps_mark_unfavorite(a)}),jq("#activity-stream").on("click","input[name=ac_form_submit]",function(a){var b=jq(this).parents(".activity-item"),c=b.find(".activity-inner > .buddyboss-media-photos-wrap-container");c.length>0&&jq(c).find(".buddyboss-media-photo-wrap .buddyboss-media-photo").each(function(){var a=jq(this),b=a.attr("data-comment-count"),c=parseInt(b)+1;a.attr("data-comment-count",c)})}),jq("#activity-stream").on("click","a.acomment-delete",function(a){var b=jq(this).parents(".activity-item"),c=jq(this).parents("li[id^=acomment]:first").find("li[id^=acomment]");if(0<c.length)var d=c.length+1;else var d=1;var e=b.find(".activity-inner > .buddyboss-media-photos-wrap-container");e.length>0&&jq(e).find(".buddyboss-media-photo-wrap .buddyboss-media-photo").each(function(){var a=jq(this),b=a.attr("data-comment-count");if(0<=b){var c=parseInt(b)-d;a.attr("data-comment-count",c)}})}),jq("div.buddyboss-media-photos-wrap-container").each(function(a,b){var c=jq(this).find("a.size-activity-2-thumbnail-tall");tall_images_height_scale(c[0],c[1])}),jq(document).on("click","a.browse-file-button",function(a){a.preventDefault()})});var hidden,visibilityChange;"undefined"!=typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!=typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,setMediaPageVisibilityChange,!1),function(a,b){var c={},d={};c.init=function(){c.initTooltips()},c.initTooltips=function(){d.tooltips=jq(".buddyboss-media-tt-others"),d.tooltips.length&&d.tooltips.tooltipster({contentAsHTML:!0,functionInit:c.getTooltipContent,interactive:!0,position:"top-left",theme:"tooltipster-buddyboss"})},c.getTooltipContent=function(a,b){var c=a.closest("li").find(".buddyboss-media-tt-content").detach().html();return c},jq(document).ready(function(){1==BuddyBoss_Media_Appstate.enable_tagging&&(c.initTooltips(),a.BBMediaTooltips=c)})}(window,window.jQuery);var docCookies=docCookies||{getItem:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return!!this.hasItem(a)&&(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0)},hasItem:function(a){return!!a&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;c<b;c++)a[c]=decodeURIComponent(a[c]);return a}};